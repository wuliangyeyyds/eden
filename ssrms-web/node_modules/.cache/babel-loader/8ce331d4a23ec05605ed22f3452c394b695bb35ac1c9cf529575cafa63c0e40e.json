{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport { watch, nextTick, onMounted, toRefs, computed } from 'vue';\nimport { useEventListener } from '@vueuse/core';\nimport { pick } from 'lodash-unified';\nimport { ElSelect } from '../../select/index.mjs';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\nimport { getEventCode } from '../../../utils/dom/event.mjs';\nimport { EVENT_CODE } from '../../../constants/aria.mjs';\nimport { UPDATE_MODEL_EVENT } from '../../../constants/event.mjs';\nconst useSelect = (props, {\n  attrs,\n  emit\n}, {\n  select,\n  tree,\n  key\n}) => {\n  const ns = useNamespace(\"tree-select\");\n  watch(() => props.data, () => {\n    if (props.filterable) {\n      nextTick(() => {\n        var _a, _b;\n        (_b = tree.value) == null ? void 0 : _b.filter((_a = select.value) == null ? void 0 : _a.states.inputValue);\n      });\n    }\n  }, {\n    flush: \"post\"\n  });\n  const focusLastNode = listNode => {\n    var _a;\n    const lastNode = listNode.at(-1);\n    if (lastNode.expanded && lastNode.childNodes.at(-1)) {\n      focusLastNode([lastNode.childNodes.at(-1)]);\n    } else {\n      const el = (_a = tree.value.el$) == null ? void 0 : _a.querySelector(`[data-key=\"${listNode.at(-1).key}\"]`);\n      el == null ? void 0 : el.focus({\n        preventScroll: true\n      });\n      return;\n    }\n  };\n  onMounted(() => {\n    useEventListener(() => {\n      var _a;\n      return (_a = select.value) == null ? void 0 : _a.$el;\n    }, \"keydown\", async evt => {\n      const code = getEventCode(evt);\n      const {\n        dropdownMenuVisible\n      } = select.value;\n      if ([EVENT_CODE.down, EVENT_CODE.up].includes(code) && dropdownMenuVisible) {\n        await nextTick();\n        setTimeout(() => {\n          var _a, _b, _c;\n          if (EVENT_CODE.up === code) {\n            const listNode = tree.value.store.root.childNodes;\n            focusLastNode(listNode);\n            return;\n          }\n          (_c = (_b = (_a = select.value.optionsArray[select.value.states.hoveringIndex].$el) == null ? void 0 : _a.parentNode) == null ? void 0 : _b.parentNode) == null ? void 0 : _c.focus({\n            preventScroll: true\n          });\n        });\n      }\n    }, {\n      capture: true\n    });\n  });\n  const result = {\n    ...pick(toRefs(props), Object.keys(ElSelect.props)),\n    ...attrs,\n    class: computed(() => attrs.class),\n    style: computed(() => attrs.style),\n    \"onUpdate:modelValue\": value => emit(UPDATE_MODEL_EVENT, value),\n    valueKey: key,\n    popperClass: computed(() => {\n      const classes = [ns.e(\"popper\")];\n      if (props.popperClass) classes.push(props.popperClass);\n      return classes.join(\" \");\n    }),\n    filterMethod: (keyword = \"\") => {\n      var _a;\n      if (props.filterMethod) {\n        props.filterMethod(keyword);\n      } else if (props.remoteMethod) {\n        props.remoteMethod(keyword);\n      } else {\n        (_a = tree.value) == null ? void 0 : _a.filter(keyword);\n      }\n    }\n  };\n  return result;\n};\nexport { useSelect };","map":{"version":3,"names":["useSelect","props","attrs","emit","select","tree","key","ns","useNamespace","watch","data","filterable","nextTick","_a","_b","value","filter","states","inputValue","flush","focusLastNode","listNode","lastNode","at","expanded","childNodes","el","el$","querySelector","focus","preventScroll","onMounted","useEventListener","$el","evt","code","getEventCode","dropdownMenuVisible","EVENT_CODE","down","up","includes","setTimeout","_c","store","root","optionsArray","hoveringIndex","parentNode","capture","result","pick","toRefs","Object","keys","ElSelect","class","computed","style","UPDATE_MODEL_EVENT","valueKey","popperClass","classes","e","push","join","filterMethod","keyword","remoteMethod"],"sources":["../../../../../../packages/components/tree-select/src/select.ts"],"sourcesContent":["// @ts-nocheck\nimport { computed, nextTick, onMounted, toRefs, watch } from 'vue'\nimport { useEventListener } from '@vueuse/core'\nimport { pick } from 'lodash-unified'\nimport ElSelect from '@element-plus/components/select'\nimport { useNamespace } from '@element-plus/hooks'\nimport { EVENT_CODE, UPDATE_MODEL_EVENT } from '@element-plus/constants'\nimport { getEventCode } from '@element-plus/utils'\n\nimport type { Ref } from 'vue'\nimport type { SelectInstance } from '@element-plus/components/select'\nimport type { TreeInstance } from '@element-plus/components/tree'\n\nexport const useSelect = (\n  props,\n  { attrs, emit },\n  {\n    select,\n    tree,\n    key,\n  }: {\n    select: Ref<SelectInstance | undefined>\n    tree: Ref<TreeInstance | undefined>\n    key: Ref<string>\n  }\n) => {\n  const ns = useNamespace('tree-select')\n\n  // update tree data when use filterMethod/remoteMethod\n  watch(\n    () => props.data,\n    () => {\n      if (props.filterable) {\n        nextTick(() => {\n          // let tree node expand only, same with tree filter\n          tree.value?.filter(select.value?.states.inputValue)\n        })\n      }\n    },\n    { flush: 'post' }\n  )\n\n  const focusLastNode = (listNode) => {\n    const lastNode = listNode.at(-1)\n    if (lastNode.expanded && lastNode.childNodes.at(-1)) {\n      focusLastNode([lastNode.childNodes.at(-1)])\n    } else {\n      const el = tree.value.el$?.querySelector(\n        `[data-key=\"${listNode.at(-1).key}\"]`\n      )\n      el?.focus({ preventScroll: true })\n      return\n    }\n  }\n\n  onMounted(() => {\n    useEventListener(\n      () => select.value?.$el,\n      'keydown',\n      async (evt) => {\n        const code = getEventCode(evt)\n        const { dropdownMenuVisible } = select.value!\n        if (\n          [EVENT_CODE.down, EVENT_CODE.up].includes(code) &&\n          dropdownMenuVisible\n        ) {\n          await nextTick()\n          // wait navigateOption to finish\n          setTimeout(() => {\n            if (EVENT_CODE.up === code) {\n              const listNode = tree.value.store.root.childNodes\n              focusLastNode(listNode)\n              return\n            }\n            // el-select-dropdown__item => el-tree-node__content => el-tree-node__content\n            select.value.optionsArray[\n              select.value.states.hoveringIndex\n            ].$el?.parentNode?.parentNode?.focus({ preventScroll: true })\n          })\n        }\n      },\n      {\n        capture: true,\n      }\n    )\n  })\n\n  const result = {\n    ...pick(toRefs(props), Object.keys(ElSelect.props)),\n    ...attrs,\n    class: computed(() => attrs.class),\n    style: computed(() => attrs.style),\n    // attrs is not reactive, when v-model binding source changes,\n    // this listener is still old, see the bug(or test 'v-model source change'):\n    // https://github.com/element-plus/element-plus/issues/14204\n    'onUpdate:modelValue': (value) => emit(UPDATE_MODEL_EVENT, value),\n    valueKey: key,\n    popperClass: computed(() => {\n      const classes = [ns.e('popper')]\n      if (props.popperClass) classes.push(props.popperClass)\n      return classes.join(' ')\n    }),\n    filterMethod: (keyword = '') => {\n      if (props.filterMethod) {\n        props.filterMethod(keyword)\n      } else if (props.remoteMethod) {\n        props.remoteMethod(keyword)\n      } else {\n        // let tree node expand only, same with tree filter\n        tree.value?.filter(keyword)\n      }\n    },\n  }\n\n  return result\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}