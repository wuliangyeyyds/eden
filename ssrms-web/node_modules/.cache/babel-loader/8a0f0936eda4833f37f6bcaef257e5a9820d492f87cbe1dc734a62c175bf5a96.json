{"ast":null,"code":"import { getCurrentInstance, ref, computed, onMounted, watch } from 'vue';\nimport { draggable } from '../utils/draggable.mjs';\nimport { getClientXY } from '../../../../utils/dom/position.mjs';\nimport { getEventCode } from '../../../../utils/dom/event.mjs';\nimport { EVENT_CODE } from '../../../../constants/aria.mjs';\nimport { useNamespace } from '../../../../hooks/use-namespace/index.mjs';\nimport { addUnit } from '../../../../utils/dom/style.mjs';\nconst useSvPanel = props => {\n  const instance = getCurrentInstance();\n  const cursorRef = ref();\n  const cursorTop = ref(0);\n  const cursorLeft = ref(0);\n  const background = ref(\"hsl(0, 100%, 50%)\");\n  const saturation = computed(() => props.color.get(\"saturation\"));\n  const brightness = computed(() => props.color.get(\"value\"));\n  const hue = computed(() => props.color.get(\"hue\"));\n  function handleClick(event) {\n    var _a;\n    if (props.disabled) return;\n    const target = event.target;\n    if (target !== cursorRef.value) {\n      handleDrag(event);\n    }\n    (_a = cursorRef.value) == null ? void 0 : _a.focus({\n      preventScroll: true\n    });\n  }\n  function handleDrag(event) {\n    if (props.disabled) return;\n    const el = instance.vnode.el;\n    const rect = el.getBoundingClientRect();\n    const {\n      clientX,\n      clientY\n    } = getClientXY(event);\n    let left = clientX - rect.left;\n    let top = clientY - rect.top;\n    left = Math.max(0, left);\n    left = Math.min(left, rect.width);\n    top = Math.max(0, top);\n    top = Math.min(top, rect.height);\n    cursorLeft.value = left;\n    cursorTop.value = top;\n    props.color.set({\n      saturation: left / rect.width * 100,\n      value: 100 - top / rect.height * 100\n    });\n  }\n  function handleKeydown(event) {\n    if (props.disabled) return;\n    const {\n      shiftKey\n    } = event;\n    const code = getEventCode(event);\n    const step = shiftKey ? 10 : 1;\n    let isPreventDefault = true;\n    switch (code) {\n      case EVENT_CODE.left:\n        incrementSaturation(-step);\n        break;\n      case EVENT_CODE.right:\n        incrementSaturation(step);\n        break;\n      case EVENT_CODE.up:\n        incrementBrightness(step);\n        break;\n      case EVENT_CODE.down:\n        incrementBrightness(-step);\n        break;\n      default:\n        isPreventDefault = false;\n        break;\n    }\n    isPreventDefault && event.preventDefault();\n  }\n  function incrementSaturation(step) {\n    let next = saturation.value + step;\n    next = next < 0 ? 0 : next > 100 ? 100 : next;\n    props.color.set(\"saturation\", next);\n  }\n  function incrementBrightness(step) {\n    let next = brightness.value + step;\n    next = next < 0 ? 0 : next > 100 ? 100 : next;\n    props.color.set(\"value\", next);\n  }\n  return {\n    cursorRef,\n    cursorTop,\n    cursorLeft,\n    background,\n    saturation,\n    brightness,\n    hue,\n    handleClick,\n    handleDrag,\n    handleKeydown\n  };\n};\nconst useSvPanelDOM = (props, {\n  cursorTop,\n  cursorLeft,\n  background,\n  handleDrag\n}) => {\n  const instance = getCurrentInstance();\n  const ns = useNamespace(\"color-svpanel\");\n  function update() {\n    const saturation = props.color.get(\"saturation\");\n    const brightness = props.color.get(\"value\");\n    const el = instance.vnode.el;\n    const {\n      clientWidth: width,\n      clientHeight: height\n    } = el;\n    cursorLeft.value = saturation * width / 100;\n    cursorTop.value = (100 - brightness) * height / 100;\n    background.value = `hsl(${props.color.get(\"hue\")}, 100%, 50%)`;\n  }\n  onMounted(() => {\n    draggable(instance.vnode.el, {\n      drag: event => {\n        handleDrag(event);\n      },\n      end: event => {\n        handleDrag(event);\n      }\n    });\n    update();\n  });\n  watch([() => props.color.get(\"hue\"), () => props.color.get(\"value\"), () => props.color.value], () => update());\n  const rootKls = computed(() => ns.b());\n  const cursorKls = computed(() => ns.e(\"cursor\"));\n  const rootStyle = computed(() => ({\n    backgroundColor: background.value\n  }));\n  const cursorStyle = computed(() => ({\n    top: addUnit(cursorTop.value),\n    left: addUnit(cursorLeft.value)\n  }));\n  return {\n    rootKls,\n    cursorKls,\n    rootStyle,\n    cursorStyle,\n    update\n  };\n};\nexport { useSvPanel, useSvPanelDOM };","map":{"version":3,"names":["useSvPanel","props","instance","getCurrentInstance","cursorRef","ref","cursorTop","cursorLeft","background","saturation","computed","color","get","brightness","hue","handleClick","event","_a","disabled","target","value","handleDrag","focus","preventScroll","el","vnode","rect","getBoundingClientRect","clientX","clientY","getClientXY","left","top","Math","max","min","width","height","set","handleKeydown","shiftKey","code","getEventCode","step","isPreventDefault","EVENT_CODE","incrementSaturation","right","up","incrementBrightness","down","preventDefault","next","useSvPanelDOM","ns","useNamespace","update","clientWidth","clientHeight","onMounted","draggable","drag","end","watch","rootKls","b","cursorKls","e","rootStyle","backgroundColor","cursorStyle","addUnit"],"sources":["../../../../../../../packages/components/color-picker-panel/src/composables/use-sv-panel.ts"],"sourcesContent":["import { computed, getCurrentInstance, onMounted, ref, watch } from 'vue'\nimport { EVENT_CODE } from '@element-plus/constants'\nimport { useNamespace } from '@element-plus/hooks'\nimport { addUnit, getClientXY, getEventCode } from '@element-plus/utils'\nimport { draggable } from '../utils/draggable'\n\nimport type { SvPanelProps } from '../props/sv-panel'\n\nexport const useSvPanel = (props: SvPanelProps) => {\n  const instance = getCurrentInstance()!\n\n  const cursorRef = ref<HTMLElement>()\n  const cursorTop = ref(0)\n  const cursorLeft = ref(0)\n  const background = ref('hsl(0, 100%, 50%)')\n\n  const saturation = computed(() => props.color.get('saturation'))\n  const brightness = computed(() => props.color.get('value'))\n  const hue = computed(() => props.color.get('hue'))\n\n  function handleClick(event: MouseEvent | TouchEvent) {\n    if (props.disabled) return\n    const target = event.target\n\n    if (target !== cursorRef.value) {\n      handleDrag(event)\n    }\n    cursorRef.value?.focus({ preventScroll: true })\n  }\n\n  function handleDrag(event: MouseEvent | TouchEvent) {\n    if (props.disabled) return\n\n    const el = instance.vnode.el!\n    const rect = el.getBoundingClientRect()\n    const { clientX, clientY } = getClientXY(event)\n\n    let left = clientX - rect.left\n    let top = clientY - rect.top\n    left = Math.max(0, left)\n    left = Math.min(left, rect.width)\n\n    top = Math.max(0, top)\n    top = Math.min(top, rect.height)\n\n    cursorLeft.value = left\n    cursorTop.value = top\n    props.color.set({\n      saturation: (left / rect.width) * 100,\n      value: 100 - (top / rect.height) * 100,\n    })\n  }\n\n  function handleKeydown(event: KeyboardEvent) {\n    if (props.disabled) return\n    const { shiftKey } = event\n    const code = getEventCode(event)\n    const step = shiftKey ? 10 : 1\n    let isPreventDefault = true\n\n    switch (code) {\n      case EVENT_CODE.left:\n        incrementSaturation(-step)\n        break\n      case EVENT_CODE.right:\n        incrementSaturation(step)\n        break\n      case EVENT_CODE.up:\n        incrementBrightness(step)\n        break\n      case EVENT_CODE.down:\n        incrementBrightness(-step)\n        break\n      default:\n        isPreventDefault = false\n        break\n    }\n\n    isPreventDefault && event.preventDefault()\n  }\n\n  function incrementSaturation(step: number) {\n    let next = saturation.value + step\n    next = next < 0 ? 0 : next > 100 ? 100 : next\n    props.color.set('saturation', next)\n  }\n\n  function incrementBrightness(step: number) {\n    let next = brightness.value + step\n    next = next < 0 ? 0 : next > 100 ? 100 : next\n    props.color.set('value', next)\n  }\n\n  return {\n    cursorRef,\n    cursorTop,\n    cursorLeft,\n    background,\n    saturation,\n    brightness,\n    hue,\n    handleClick,\n    handleDrag,\n    handleKeydown,\n  }\n}\n\nexport const useSvPanelDOM = (\n  props: SvPanelProps,\n  {\n    cursorTop,\n    cursorLeft,\n    background,\n    handleDrag,\n  }: Pick<\n    ReturnType<typeof useSvPanel>,\n    'cursorTop' | 'cursorLeft' | 'background' | 'handleDrag'\n  >\n) => {\n  const instance = getCurrentInstance()!\n  const ns = useNamespace('color-svpanel')\n\n  function update() {\n    const saturation = props.color.get('saturation')\n    const brightness = props.color.get('value')\n\n    const el = instance.vnode.el!\n    const { clientWidth: width, clientHeight: height } = el\n\n    cursorLeft.value = (saturation * width) / 100\n    cursorTop.value = ((100 - brightness) * height) / 100\n\n    background.value = `hsl(${props.color.get('hue')}, 100%, 50%)`\n  }\n\n  onMounted(() => {\n    draggable(instance.vnode.el as HTMLElement, {\n      drag: (event) => {\n        handleDrag(event)\n      },\n      end: (event) => {\n        handleDrag(event)\n      },\n    })\n\n    update()\n  })\n\n  watch(\n    [\n      () => props.color.get('hue'),\n      () => props.color.get('value'),\n      () => props.color.value,\n    ],\n    () => update()\n  )\n\n  const rootKls = computed(() => ns.b())\n  const cursorKls = computed(() => ns.e('cursor'))\n  const rootStyle = computed(() => ({\n    backgroundColor: background.value,\n  }))\n  const cursorStyle = computed(() => ({\n    top: addUnit(cursorTop.value),\n    left: addUnit(cursorLeft.value),\n  }))\n\n  return {\n    rootKls,\n    cursorKls,\n    rootStyle,\n    cursorStyle,\n    update,\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}