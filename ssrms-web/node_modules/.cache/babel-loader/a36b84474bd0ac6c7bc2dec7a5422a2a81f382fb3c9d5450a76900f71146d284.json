{"ast":null,"code":"import \"core-js/modules/esnext.json.parse.js\";\n// src/router/index.js\nimport { createRouter, createWebHistory } from 'vue-router';\nimport LoginRegister from '@/components/LoginRegister.vue'; // ✅ 统一登录/注册页面\nimport UserIndex from '@/components/UserIndex.vue'; // 学生端\nimport AdminIndex from '@/components/AdminIndex.vue'; // 管理员端\n\nconst routes = [{\n  path: '/',\n  redirect: '/login'\n},\n// ✅ 登录页直接使用 LoginRegister\n{\n  path: '/login',\n  name: 'Login',\n  component: LoginRegister\n},\n// 学生端，需要登录，role=user\n{\n  path: '/user',\n  name: 'UserHome',\n  component: UserIndex,\n  meta: {\n    requiresAuth: true,\n    role: 'user'\n  }\n},\n// 管理员端，需要登录，role=admin\n{\n  path: '/admin',\n  name: 'AdminHome',\n  component: AdminIndex,\n  meta: {\n    requiresAuth: true,\n    role: 'admin'\n  }\n}];\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n});\n\n// 读取登录用户（更稳：JSON 解析失败就当未登录）\nfunction getLoginUser() {\n  const raw = localStorage.getItem('ssrmsUser');\n  if (!raw) return null;\n  try {\n    return JSON.parse(raw);\n  } catch (e) {\n    localStorage.removeItem('ssrmsUser');\n    return null;\n  }\n}\nrouter.beforeEach((to, from, next) => {\n  const user = getLoginUser();\n\n  // 1) 需要登录的页面\n  if (to.meta && to.meta.requiresAuth) {\n    if (!user) {\n      return next({\n        path: '/login',\n        query: {\n          redirect: to.fullPath\n        }\n      });\n    }\n\n    // 2) 角色检查：roleId 0=管理员, 1=学生\n    //    如果角色不匹配，直接送回“他该去的首页”（体验更好）\n    if (to.meta.role === 'admin' && user.roleId !== 0) {\n      return next('/user');\n    }\n    if (to.meta.role === 'user' && user.roleId !== 1) {\n      return next('/admin');\n    }\n  }\n\n  // 3) 已登录又去 /login，就直接回对应首页\n  if (to.path === '/login' && user) {\n    return next(user.roleId === 0 ? '/admin' : '/user');\n  }\n  next();\n});\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","LoginRegister","UserIndex","AdminIndex","routes","path","redirect","name","component","meta","requiresAuth","role","router","history","getLoginUser","raw","localStorage","getItem","JSON","parse","e","removeItem","beforeEach","to","from","next","user","query","fullPath","roleId"],"sources":["D:/code/SpringBoot-Vue-SSRMS/ssrms-web/src/router/index.js"],"sourcesContent":["// src/router/index.js\r\nimport { createRouter, createWebHistory } from 'vue-router'\r\nimport LoginRegister from '@/components/LoginRegister.vue' // ✅ 统一登录/注册页面\r\nimport UserIndex from '@/components/UserIndex.vue'         // 学生端\r\nimport AdminIndex from '@/components/AdminIndex.vue'       // 管理员端\r\n\r\nconst routes = [\r\n    { path: '/', redirect: '/login' },\r\n\r\n    // ✅ 登录页直接使用 LoginRegister\r\n    { path: '/login', name: 'Login', component: LoginRegister },\r\n\r\n    // 学生端，需要登录，role=user\r\n    {\r\n        path: '/user',\r\n        name: 'UserHome',\r\n        component: UserIndex,\r\n        meta: {\r\n            requiresAuth: true,\r\n            role: 'user'\r\n        }\r\n    },\r\n\r\n    // 管理员端，需要登录，role=admin\r\n    {\r\n        path: '/admin',\r\n        name: 'AdminHome',\r\n        component: AdminIndex,\r\n        meta: {\r\n            requiresAuth: true,\r\n            role: 'admin'\r\n        }\r\n    }\r\n]\r\n\r\nconst router = createRouter({\r\n    history: createWebHistory(),\r\n    routes\r\n})\r\n\r\n// 读取登录用户（更稳：JSON 解析失败就当未登录）\r\nfunction getLoginUser () {\r\n    const raw = localStorage.getItem('ssrmsUser')\r\n    if (!raw) return null\r\n    try {\r\n        return JSON.parse(raw)\r\n    } catch (e) {\r\n        localStorage.removeItem('ssrmsUser')\r\n        return null\r\n    }\r\n}\r\n\r\nrouter.beforeEach((to, from, next) => {\r\n    const user = getLoginUser()\r\n\r\n    // 1) 需要登录的页面\r\n    if (to.meta && to.meta.requiresAuth) {\r\n        if (!user) {\r\n            return next({\r\n                path: '/login',\r\n                query: { redirect: to.fullPath }\r\n            })\r\n        }\r\n\r\n        // 2) 角色检查：roleId 0=管理员, 1=学生\r\n        //    如果角色不匹配，直接送回“他该去的首页”（体验更好）\r\n        if (to.meta.role === 'admin' && user.roleId !== 0) {\r\n            return next('/user')\r\n        }\r\n        if (to.meta.role === 'user' && user.roleId !== 1) {\r\n            return next('/admin')\r\n        }\r\n    }\r\n\r\n    // 3) 已登录又去 /login，就直接回对应首页\r\n    if (to.path === '/login' && user) {\r\n        return next(user.roleId === 0 ? '/admin' : '/user')\r\n    }\r\n\r\n    next()\r\n})\r\n\r\nexport default router"],"mappings":";AAAA;AACA,SAASA,YAAY,EAAEC,gBAAgB,QAAQ,YAAY;AAC3D,OAAOC,aAAa,MAAM,gCAAgC,EAAC;AAC3D,OAAOC,SAAS,MAAM,4BAA4B,EAAS;AAC3D,OAAOC,UAAU,MAAM,6BAA6B,EAAO;;AAE3D,MAAMC,MAAM,GAAG,CACX;EAAEC,IAAI,EAAE,GAAG;EAAEC,QAAQ,EAAE;AAAS,CAAC;AAEjC;AACA;EAAED,IAAI,EAAE,QAAQ;EAAEE,IAAI,EAAE,OAAO;EAAEC,SAAS,EAAEP;AAAc,CAAC;AAE3D;AACA;EACII,IAAI,EAAE,OAAO;EACbE,IAAI,EAAE,UAAU;EAChBC,SAAS,EAAEN,SAAS;EACpBO,IAAI,EAAE;IACFC,YAAY,EAAE,IAAI;IAClBC,IAAI,EAAE;EACV;AACJ,CAAC;AAED;AACA;EACIN,IAAI,EAAE,QAAQ;EACdE,IAAI,EAAE,WAAW;EACjBC,SAAS,EAAEL,UAAU;EACrBM,IAAI,EAAE;IACFC,YAAY,EAAE,IAAI;IAClBC,IAAI,EAAE;EACV;AACJ,CAAC,CACJ;AAED,MAAMC,MAAM,GAAGb,YAAY,CAAC;EACxBc,OAAO,EAAEb,gBAAgB,CAAC,CAAC;EAC3BI;AACJ,CAAC,CAAC;;AAEF;AACA,SAASU,YAAYA,CAAA,EAAI;EACrB,MAAMC,GAAG,GAAGC,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC;EAC7C,IAAI,CAACF,GAAG,EAAE,OAAO,IAAI;EACrB,IAAI;IACA,OAAOG,IAAI,CAACC,KAAK,CAACJ,GAAG,CAAC;EAC1B,CAAC,CAAC,OAAOK,CAAC,EAAE;IACRJ,YAAY,CAACK,UAAU,CAAC,WAAW,CAAC;IACpC,OAAO,IAAI;EACf;AACJ;AAEAT,MAAM,CAACU,UAAU,CAAC,CAACC,EAAE,EAAEC,IAAI,EAAEC,IAAI,KAAK;EAClC,MAAMC,IAAI,GAAGZ,YAAY,CAAC,CAAC;;EAE3B;EACA,IAAIS,EAAE,CAACd,IAAI,IAAIc,EAAE,CAACd,IAAI,CAACC,YAAY,EAAE;IACjC,IAAI,CAACgB,IAAI,EAAE;MACP,OAAOD,IAAI,CAAC;QACRpB,IAAI,EAAE,QAAQ;QACdsB,KAAK,EAAE;UAAErB,QAAQ,EAAEiB,EAAE,CAACK;QAAS;MACnC,CAAC,CAAC;IACN;;IAEA;IACA;IACA,IAAIL,EAAE,CAACd,IAAI,CAACE,IAAI,KAAK,OAAO,IAAIe,IAAI,CAACG,MAAM,KAAK,CAAC,EAAE;MAC/C,OAAOJ,IAAI,CAAC,OAAO,CAAC;IACxB;IACA,IAAIF,EAAE,CAACd,IAAI,CAACE,IAAI,KAAK,MAAM,IAAIe,IAAI,CAACG,MAAM,KAAK,CAAC,EAAE;MAC9C,OAAOJ,IAAI,CAAC,QAAQ,CAAC;IACzB;EACJ;;EAEA;EACA,IAAIF,EAAE,CAAClB,IAAI,KAAK,QAAQ,IAAIqB,IAAI,EAAE;IAC9B,OAAOD,IAAI,CAACC,IAAI,CAACG,MAAM,KAAK,CAAC,GAAG,QAAQ,GAAG,OAAO,CAAC;EACvD;EAEAJ,IAAI,CAAC,CAAC;AACV,CAAC,CAAC;AAEF,eAAeb,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}