{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeClass as _normalizeClass, vShow as _vShow, normalizeStyle as _normalizeStyle, withDirectives as _withDirectives, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, createBlock as _createBlock, withModifiers as _withModifiers, withKeys as _withKeys } from \"vue\";\nconst _hoisted_1 = {\n  class: \"ai-lite-root\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"ai-float-dot\"\n};\nconst _hoisted_3 = {\n  class: \"ai-shell\"\n};\nconst _hoisted_4 = {\n  class: \"ai-header\"\n};\nconst _hoisted_5 = {\n  class: \"ai-actions\"\n};\nconst _hoisted_6 = {\n  key: 0,\n  class: \"ai-quick\"\n};\nconst _hoisted_7 = {\n  class: \"ai-quick-row\"\n};\nconst _hoisted_8 = {\n  class: \"ai-quick-items\"\n};\nconst _hoisted_9 = {\n  class: \"ai-msgs\"\n};\nconst _hoisted_10 = {\n  key: 0,\n  class: \"ai-empty\"\n};\nconst _hoisted_11 = {\n  class: \"ai-avatar\"\n};\nconst _hoisted_12 = {\n  key: 0\n};\nconst _hoisted_13 = {\n  key: 1\n};\nconst _hoisted_14 = {\n  class: \"ai-bubble\"\n};\nconst _hoisted_15 = [\"textContent\"];\nconst _hoisted_16 = {\n  class: \"ai-meta\"\n};\nconst _hoisted_17 = {\n  key: 1,\n  class: \"ai-msg is-ai\"\n};\nconst _hoisted_18 = {\n  class: \"ai-input\"\n};\nconst _hoisted_19 = {\n  class: \"ai-sendbar\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_tag = _resolveComponent(\"el-tag\");\n  const _component_el_scrollbar = _resolveComponent(\"el-scrollbar\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_drawer = _resolveComponent(\"el-drawer\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" ÊÇ¨ÊµÆÁêÉÔºöÈïøÊåâÊãñÂä®ÔºõÁÇπÂáªÊâìÂºÄ \"), _withDirectives(_createElementVNode(\"div\", {\n    class: \"ai-float\",\n    style: _normalizeStyle($options.floatStyle),\n    onPointerdown: _cache[0] || (_cache[0] = (...args) => $options.onPointerDown && $options.onPointerDown(...args)),\n    onPointermove: _cache[1] || (_cache[1] = (...args) => $options.onPointerMove && $options.onPointerMove(...args)),\n    onPointerup: _cache[2] || (_cache[2] = (...args) => $options.onPointerUp && $options.onPointerUp(...args)),\n    onPointercancel: _cache[3] || (_cache[3] = (...args) => $options.onPointerUp && $options.onPointerUp(...args))\n  }, [_createElementVNode(\"div\", {\n    class: _normalizeClass([\"ai-float-inner\", {\n      dragging: $data.dragging\n    }]),\n    title: \"AI Ëá™‰π†ÂÆ§Âä©ÊâãÔºàÈïøÊåâÊãñÂä®Ôºâ\"\n  }, [_cache[8] || (_cache[8] = _createElementVNode(\"div\", {\n    class: \"ai-float-emoji\"\n  }, \"ü§ñ\", -1 /* CACHED */)), $data.hasUnreadHint ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2)) : _createCommentVNode(\"v-if\", true)], 2 /* CLASS */)], 36 /* STYLE, NEED_HYDRATION */), [[_vShow, !$data.drawerVisible]]), _createCommentVNode(\" ÊäΩÂ±âËÅäÂ§©Á™óÔºö‰ºöË¶ÜÁõñÈ°µÈù¢ÔºàÊÇ¨ÊµÆÁêÉÂêåÊó∂ÈöêËóèÔºâ \"), _createVNode(_component_el_drawer, {\n    modelValue: $data.drawerVisible,\n    \"onUpdate:modelValue\": _cache[7] || (_cache[7] = $event => $data.drawerVisible = $event),\n    \"with-header\": false,\n    size: \"440px\",\n    class: \"ai-drawer\",\n    \"append-to-body\": true,\n    modal: true,\n    \"lock-scroll\": true\n  }, {\n    default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_3, [_createCommentVNode(\" Header \"), _createElementVNode(\"div\", _hoisted_4, [_cache[11] || (_cache[11] = _createElementVNode(\"div\", {\n      class: \"ai-brand\"\n    }, [_createElementVNode(\"div\", {\n      class: \"ai-brand-icon\"\n    }, \"ü§ñ\"), _createElementVNode(\"div\", {\n      class: \"ai-brand-text\"\n    }, [_createElementVNode(\"div\", {\n      class: \"ai-title\"\n    }, \"AI Ëá™‰π†ÂÆ§Âä©Êâã\"), _createElementVNode(\"div\", {\n      class: \"ai-subtitle\"\n    }, \"È¢ÑÁ∫¶ / Á≠æÂà∞ / ‰ø°Áî®ËßÑÂàô ¬∑ ËΩªÈáèÁâà\")])], -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_5, [_createVNode(_component_el_button, {\n      size: \"small\",\n      onClick: $options.clearChat,\n      disabled: $data.sending\n    }, {\n      default: _withCtx(() => [...(_cache[9] || (_cache[9] = [_createTextVNode(\"Ê∏ÖÁ©∫\", -1 /* CACHED */)]))]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"onClick\", \"disabled\"]), _createVNode(_component_el_button, {\n      size: \"small\",\n      onClick: _cache[4] || (_cache[4] = $event => $data.drawerVisible = false)\n    }, {\n      default: _withCtx(() => [...(_cache[10] || (_cache[10] = [_createTextVNode(\"ÂÖ≥Èó≠\", -1 /* CACHED */)]))]),\n      _: 1 /* STABLE */\n    })])]), _createCommentVNode(\" Âø´Êç∑ÊèêÈóÆÔºàÂèØ‰øùÁïôÔºå‰πüÂèØÂêéÁª≠Âà†Ôºâ \"), $data.showQuick ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [_createElementVNode(\"div\", _hoisted_7, [_cache[12] || (_cache[12] = _createElementVNode(\"div\", {\n      class: \"ai-quick-label\"\n    }, \"Âø´Êç∑ÊèêÈóÆ\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_8, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.quickQuestions, q => {\n      return _openBlock(), _createBlock(_component_el_tag, {\n        key: q,\n        class: \"ai-chip\",\n        effect: \"plain\",\n        onClick: $event => $options.useQuick(q)\n      }, {\n        default: _withCtx(() => [_createTextVNode(_toDisplayString(q), 1 /* TEXT */)]),\n        _: 2 /* DYNAMIC */\n      }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"]);\n    }), 128 /* KEYED_FRAGMENT */))])])])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" Messages \"), _createVNode(_component_el_scrollbar, {\n      class: \"ai-body\"\n    }, {\n      default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_9, [$data.messages.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [...(_cache[13] || (_cache[13] = [_createElementVNode(\"div\", {\n        class: \"ai-empty-title\"\n      }, \"‰ªäÂ§©‰πüË¶ÅÂ•ΩÂ•ΩÂ≠¶‰π†Ôºà‰ΩÜÂà´ÊääËá™Â∑±Â≠¶ÊàêÂºÇÂ∏∏ÂÄºÔºâ\", -1 /* CACHED */), _createElementVNode(\"div\", {\n        class: \"ai-empty-desc\"\n      }, \" ‰Ω†ÂèØ‰ª•ÈóÆÔºöÊÄé‰πàÈ¢ÑÁ∫¶ÔºüÊàë‰ªäÂ§©ÊúâÂì™‰∫õÈ¢ÑÁ∫¶Ôºü‰∏∫‰ªÄ‰πàÂèòÈ¢ÑË≠¶/ÈªëÂêçÂçïÔºü \", -1 /* CACHED */)]))])) : _createCommentVNode(\"v-if\", true), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.messages, m => {\n        return _openBlock(), _createElementBlock(\"div\", {\n          key: m.id,\n          class: _normalizeClass(['ai-msg', m.role === 'user' ? 'is-user' : 'is-ai'])\n        }, [_createElementVNode(\"div\", _hoisted_11, [m.role === 'user' ? (_openBlock(), _createElementBlock(\"span\", _hoisted_12, \"‰Ω†\")) : (_openBlock(), _createElementBlock(\"span\", _hoisted_13, \"AI\"))]), _createElementVNode(\"div\", _hoisted_14, [_createElementVNode(\"div\", {\n          class: \"ai-text\",\n          textContent: _toDisplayString(m.text)\n        }, null, 8 /* PROPS */, _hoisted_15), _createElementVNode(\"div\", _hoisted_16, _toDisplayString($options.formatTime(m.ts)), 1 /* TEXT */)])], 2 /* CLASS */);\n      }), 128 /* KEYED_FRAGMENT */)), $data.sending ? (_openBlock(), _createElementBlock(\"div\", _hoisted_17, [...(_cache[14] || (_cache[14] = [_createElementVNode(\"div\", {\n        class: \"ai-avatar\"\n      }, \"AI\", -1 /* CACHED */), _createElementVNode(\"div\", {\n        class: \"ai-bubble\"\n      }, [_createElementVNode(\"div\", {\n        class: \"ai-text\"\n      }, \"Ê≠£Âú®ÊÄùËÄÉ‚Ä¶\")], -1 /* CACHED */)]))])) : _createCommentVNode(\"v-if\", true)])]),\n      _: 1 /* STABLE */\n    }), _createCommentVNode(\" Input \"), _createElementVNode(\"div\", _hoisted_18, [_createVNode(_component_el_input, {\n      modelValue: $data.inputText,\n      \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => $data.inputText = $event),\n      type: \"textarea\",\n      autosize: {\n        minRows: 2,\n        maxRows: 5\n      },\n      placeholder: \"ËæìÂÖ•ÈóÆÈ¢òÔºå‰æãÂ¶ÇÔºöÊÄé‰πàÈ¢ÑÁ∫¶ÔºüÊàë‰ªäÂ§©ÊúâÂì™‰∫õÈ¢ÑÁ∫¶Ôºü\",\n      onKeydown: [_withKeys(_withModifiers($options.send, [\"exact\", \"prevent\"]), [\"enter\"]), _cache[6] || (_cache[6] = _withKeys(_withModifiers(() => {}, [\"shift\", \"exact\", \"stop\"]), [\"enter\"]))]\n    }, null, 8 /* PROPS */, [\"modelValue\", \"onKeydown\"]), _createElementVNode(\"div\", _hoisted_19, [_cache[16] || (_cache[16] = _createElementVNode(\"div\", {\n      class: \"ai-hint\"\n    }, \"Enter ÂèëÈÄÅ ¬∑ Shift+Enter Êç¢Ë°å ¬∑ ÈïøÊåâÊÇ¨ÊµÆÁêÉÂèØÊãñÂä®\", -1 /* CACHED */)), _createVNode(_component_el_button, {\n      class: \"ai-send-btn\",\n      type: \"primary\",\n      loading: $data.sending,\n      disabled: $data.sending || !$data.inputText.trim(),\n      onClick: $options.send\n    }, {\n      default: _withCtx(() => [...(_cache[15] || (_cache[15] = [_createTextVNode(\" ÂèëÈÄÅ \", -1 /* CACHED */)]))]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"loading\", \"disabled\", \"onClick\"])])])])]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\"])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createCommentVNode","_createElementVNode","style","_normalizeStyle","$options","floatStyle","onPointerdown","_cache","args","onPointerDown","onPointermove","onPointerMove","onPointerup","onPointerUp","onPointercancel","_normalizeClass","dragging","$data","title","hasUnreadHint","_hoisted_2","drawerVisible","_createVNode","_component_el_drawer","$event","size","modal","_hoisted_3","_hoisted_4","_hoisted_5","_component_el_button","onClick","clearChat","disabled","sending","showQuick","_hoisted_6","_hoisted_7","_hoisted_8","_Fragment","_renderList","quickQuestions","q","_createBlock","_component_el_tag","key","effect","useQuick","_component_el_scrollbar","_hoisted_9","messages","length","_hoisted_10","m","id","role","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_toDisplayString","text","_hoisted_16","formatTime","ts","_hoisted_17","_hoisted_18","_component_el_input","inputText","type","autosize","minRows","maxRows","placeholder","onKeydown","send","_hoisted_19","loading","trim"],"sources":["D:\\code\\SpringBoot-Vue-SSRMS\\ssrms-web\\src\\components\\AiAssistantLite.vue"],"sourcesContent":["<template>\n  <div class=\"ai-lite-root\">\n    <!-- ÊÇ¨ÊµÆÁêÉÔºöÈïøÊåâÊãñÂä®ÔºõÁÇπÂáªÊâìÂºÄ -->\n    <div\n        v-show=\"!drawerVisible\"\n        class=\"ai-float\"\n        :style=\"floatStyle\"\n        @pointerdown=\"onPointerDown\"\n        @pointermove=\"onPointerMove\"\n        @pointerup=\"onPointerUp\"\n        @pointercancel=\"onPointerUp\"\n    >\n      <div class=\"ai-float-inner\" :class=\"{ dragging: dragging }\" title=\"AI Ëá™‰π†ÂÆ§Âä©ÊâãÔºàÈïøÊåâÊãñÂä®Ôºâ\">\n        <div class=\"ai-float-emoji\">ü§ñ</div>\n        <div class=\"ai-float-dot\" v-if=\"hasUnreadHint\"></div>\n      </div>\n    </div>\n\n    <!-- ÊäΩÂ±âËÅäÂ§©Á™óÔºö‰ºöË¶ÜÁõñÈ°µÈù¢ÔºàÊÇ¨ÊµÆÁêÉÂêåÊó∂ÈöêËóèÔºâ -->\n    <el-drawer\n        v-model=\"drawerVisible\"\n        :with-header=\"false\"\n        size=\"440px\"\n        class=\"ai-drawer\"\n        :append-to-body=\"true\"\n        :modal=\"true\"\n        :lock-scroll=\"true\"\n    >\n      <div class=\"ai-shell\">\n        <!-- Header -->\n        <div class=\"ai-header\">\n          <div class=\"ai-brand\">\n            <div class=\"ai-brand-icon\">ü§ñ</div>\n            <div class=\"ai-brand-text\">\n              <div class=\"ai-title\">AI Ëá™‰π†ÂÆ§Âä©Êâã</div>\n              <div class=\"ai-subtitle\">È¢ÑÁ∫¶ / Á≠æÂà∞ / ‰ø°Áî®ËßÑÂàô ¬∑ ËΩªÈáèÁâà</div>\n            </div>\n          </div>\n\n          <div class=\"ai-actions\">\n            <el-button size=\"small\" @click=\"clearChat\" :disabled=\"sending\">Ê∏ÖÁ©∫</el-button>\n            <el-button size=\"small\" @click=\"drawerVisible = false\">ÂÖ≥Èó≠</el-button>\n          </div>\n        </div>\n\n        <!-- Âø´Êç∑ÊèêÈóÆÔºàÂèØ‰øùÁïôÔºå‰πüÂèØÂêéÁª≠Âà†Ôºâ -->\n        <div class=\"ai-quick\" v-if=\"showQuick\">\n          <div class=\"ai-quick-row\">\n            <div class=\"ai-quick-label\">Âø´Êç∑ÊèêÈóÆ</div>\n            <div class=\"ai-quick-items\">\n              <el-tag\n                  v-for=\"q in quickQuestions\"\n                  :key=\"q\"\n                  class=\"ai-chip\"\n                  effect=\"plain\"\n                  @click=\"useQuick(q)\"\n              >\n                {{ q }}\n              </el-tag>\n            </div>\n          </div>\n        </div>\n\n        <!-- Messages -->\n        <el-scrollbar class=\"ai-body\">\n          <div class=\"ai-msgs\">\n            <div v-if=\"messages.length === 0\" class=\"ai-empty\">\n              <div class=\"ai-empty-title\">‰ªäÂ§©‰πüË¶ÅÂ•ΩÂ•ΩÂ≠¶‰π†Ôºà‰ΩÜÂà´ÊääËá™Â∑±Â≠¶ÊàêÂºÇÂ∏∏ÂÄºÔºâ</div>\n              <div class=\"ai-empty-desc\">\n                ‰Ω†ÂèØ‰ª•ÈóÆÔºöÊÄé‰πàÈ¢ÑÁ∫¶ÔºüÊàë‰ªäÂ§©ÊúâÂì™‰∫õÈ¢ÑÁ∫¶Ôºü‰∏∫‰ªÄ‰πàÂèòÈ¢ÑË≠¶/ÈªëÂêçÂçïÔºü\n              </div>\n            </div>\n\n            <div\n                v-for=\"m in messages\"\n                :key=\"m.id\"\n                :class=\"['ai-msg', m.role === 'user' ? 'is-user' : 'is-ai']\"\n            >\n              <div class=\"ai-avatar\">\n                <span v-if=\"m.role === 'user'\">‰Ω†</span>\n                <span v-else>AI</span>\n              </div>\n\n              <div class=\"ai-bubble\">\n                <div class=\"ai-text\" v-text=\"m.text\"></div>\n                <div class=\"ai-meta\">{{ formatTime(m.ts) }}</div>\n              </div>\n            </div>\n\n            <div v-if=\"sending\" class=\"ai-msg is-ai\">\n              <div class=\"ai-avatar\">AI</div>\n              <div class=\"ai-bubble\">\n                <div class=\"ai-text\">Ê≠£Âú®ÊÄùËÄÉ‚Ä¶</div>\n              </div>\n            </div>\n          </div>\n        </el-scrollbar>\n\n        <!-- Input -->\n        <div class=\"ai-input\">\n          <el-input\n              v-model=\"inputText\"\n              type=\"textarea\"\n              :autosize=\"{ minRows: 2, maxRows: 5 }\"\n              placeholder=\"ËæìÂÖ•ÈóÆÈ¢òÔºå‰æãÂ¶ÇÔºöÊÄé‰πàÈ¢ÑÁ∫¶ÔºüÊàë‰ªäÂ§©ÊúâÂì™‰∫õÈ¢ÑÁ∫¶Ôºü\"\n              @keydown.enter.exact.prevent=\"send\"\n              @keydown.enter.shift.exact.stop\n          />\n          <div class=\"ai-sendbar\">\n            <div class=\"ai-hint\">Enter ÂèëÈÄÅ ¬∑ Shift+Enter Êç¢Ë°å ¬∑ ÈïøÊåâÊÇ¨ÊµÆÁêÉÂèØÊãñÂä®</div>\n            <el-button\n                class=\"ai-send-btn\"\n                type=\"primary\"\n                :loading=\"sending\"\n                :disabled=\"sending || !inputText.trim()\"\n                @click=\"send\"\n            >\n              ÂèëÈÄÅ\n            </el-button>\n          </div>\n        </div>\n      </div>\n    </el-drawer>\n  </div>\n</template>\n\n<script>\nimport { ElMessage } from 'element-plus'\n\nexport default {\n  name: 'AiAssistantLite',\n  props: {\n    userId: {\n      type: [Number, String],\n      default: null\n    }\n  },\n  data () {\n    return {\n      // drawer\n      drawerVisible: false,\n\n      // chat\n      inputText: '',\n      sending: false,\n      conversationId: '',\n      messages: [],\n\n      // quick prompts\n      showQuick: true,\n      quickQuestions: [\n        'ÊÄé‰πàÈ¢ÑÁ∫¶Â∫ß‰ΩçÔºü',\n        'Êàë‰ªäÂ§©ÊúâÂì™‰∫õÈ¢ÑÁ∫¶Ôºü',\n        '‰∏∫‰ªÄ‰πàÊàëÂèòÊàêÈ¢ÑË≠¶/ÈªëÂêçÂçïÔºü',\n        'Â¶Ç‰ΩïÁ≠æÂà∞/Á≠æÈÄÄÔºü'\n      ],\n\n      // floating ball drag\n      floatX: null,\n      floatY: null,\n      dragging: false,\n      longPressTimer: null,\n      longPressMs: 260,\n      startClientX: 0,\n      startClientY: 0,\n      startFloatX: 0,\n      startFloatY: 0,\n      pointerId: null,\n\n      hasUnreadHint: false\n    }\n  },\n  computed: {\n    resolvedUserId () {\n      const p = this.userId\n      if (p !== null && p !== undefined && String(p).trim() !== '') return Number(p)\n\n      try {\n        const raw = localStorage.getItem('ssrmsUser') || sessionStorage.getItem('ssrmsUser')\n        if (!raw) return null\n        const u = JSON.parse(raw)\n        const id = u.userId ?? u.id ?? null\n        return id === null ? null : Number(id)\n      } catch (e) {\n        return null\n      }\n    },\n    storageKey () {\n      return `ssrms_ai_lite_${this.resolvedUserId ?? 'guest'}`\n    },\n    floatPosKey () {\n      return `ssrms_ai_float_pos_${this.resolvedUserId ?? 'guest'}`\n    },\n    floatStyle () {\n      const x = (this.floatX === null || this.floatX === undefined)\n          ? (window.innerWidth - 18 - 56)\n          : this.floatX\n      const y = (this.floatY === null || this.floatY === undefined)\n          ? (window.innerHeight - 18 - 56)\n          : this.floatY\n\n      return { left: `${x}px`, top: `${y}px` }\n    }\n  },\n  mounted () {\n    this.loadFromStorage()\n    this.restoreFloatPos()\n    window.addEventListener('resize', this.clampFloatToViewport)\n  },\n  beforeUnmount () {\n    window.removeEventListener('resize', this.clampFloatToViewport)\n  },\n  watch: {\n    drawerVisible (v) {\n      if (v) {\n        this.hasUnreadHint = false\n        this.$nextTick(() => this.scrollToBottom())\n      }\n    }\n  },\n  methods: {\n    // ---------- ÊÇ¨ÊµÆÁêÉÊãñÂä® ----------\n    restoreFloatPos () {\n      try {\n        const raw = localStorage.getItem(this.floatPosKey)\n        if (!raw) return\n        const obj = JSON.parse(raw)\n        if (typeof obj.x === 'number' && typeof obj.y === 'number') {\n          this.floatX = obj.x\n          this.floatY = obj.y\n          this.clampFloatToViewport()\n        }\n      } catch (e) {\n        // Êú¨Âú∞Â≠òÂÇ®ÂèØËÉΩ‰∏çÂèØÁî®ÔºåÂøΩÁï•Âç≥ÂèØ\n      }\n    },\n    saveFloatPos () {\n      try {\n        localStorage.setItem(this.floatPosKey, JSON.stringify({ x: this.floatX, y: this.floatY }))\n      } catch (e) {\n        // Êú¨Âú∞Â≠òÂÇ®ÂèØËÉΩ‰∏çÂèØÁî®ÔºåÂøΩÁï•Âç≥ÂèØ\n      }\n    },\n    clampFloatToViewport () {\n      const size = 56\n      const pad = 8\n      const maxX = Math.max(pad, window.innerWidth - size - pad)\n      const maxY = Math.max(pad, window.innerHeight - size - pad)\n\n      if (this.floatX === null || this.floatX === undefined) this.floatX = maxX\n      if (this.floatY === null || this.floatY === undefined) this.floatY = maxY\n\n      this.floatX = Math.min(Math.max(this.floatX, pad), maxX)\n      this.floatY = Math.min(Math.max(this.floatY, pad), maxY)\n    },\n    onPointerDown (e) {\n      if (e.button !== undefined && e.button !== 0) return\n\n      this.pointerId = e.pointerId\n      this.startClientX = e.clientX\n      this.startClientY = e.clientY\n\n      const rect = e.currentTarget.getBoundingClientRect()\n      this.startFloatX = rect.left\n      this.startFloatY = rect.top\n\n      this.longPressTimer = setTimeout(() => {\n        this.dragging = true\n        this.hasUnreadHint = false\n        try {\n          e.currentTarget.setPointerCapture(this.pointerId)\n        } catch (err) {\n          // ÈÉ®ÂàÜÊµèËßàÂô®‰∏çÊîØÊåÅ captureÔºåÂøΩÁï•Âç≥ÂèØ\n        }\n      }, this.longPressMs)\n    },\n    onPointerMove (e) {\n      if (this.pointerId === null || e.pointerId !== this.pointerId) return\n\n      const dx0 = e.clientX - this.startClientX\n      const dy0 = e.clientY - this.startClientY\n      const movedFar = Math.hypot(dx0, dy0) > 10\n\n      if (!this.dragging && movedFar && this.longPressTimer) {\n        clearTimeout(this.longPressTimer)\n        this.longPressTimer = null\n        this.dragging = true\n      }\n\n      if (!this.dragging) return\n\n      const dx = e.clientX - this.startClientX\n      const dy = e.clientY - this.startClientY\n      this.floatX = this.startFloatX + dx\n      this.floatY = this.startFloatY + dy\n      this.clampFloatToViewport()\n    },\n    onPointerUp () {\n      if (this.longPressTimer) {\n        clearTimeout(this.longPressTimer)\n        this.longPressTimer = null\n      }\n\n      if (this.dragging) {\n        this.dragging = false\n        this.pointerId = null\n        this.saveFloatPos()\n        return\n      }\n\n      this.pointerId = null\n      this.openDrawer()\n    },\n\n    // ---------- ËÅäÂ§© ----------\n    openDrawer () {\n      this.drawerVisible = true\n      this.loadFromStorage()\n      this.$nextTick(() => this.scrollToBottom())\n    },\n    loadFromStorage () {\n      try {\n        const raw = localStorage.getItem(this.storageKey)\n        if (!raw) {\n          this.messages = []\n          this.conversationId = ''\n          return\n        }\n        const obj = JSON.parse(raw)\n        this.messages = Array.isArray(obj.messages) ? obj.messages : []\n        this.conversationId = obj.conversationId || ''\n      } catch (e) {\n        this.messages = []\n        this.conversationId = ''\n      }\n    },\n    saveToStorage () {\n      try {\n        localStorage.setItem(this.storageKey, JSON.stringify({\n          conversationId: this.conversationId || '',\n          messages: this.messages || []\n        }))\n      } catch (e) {\n        // Êú¨Âú∞Â≠òÂÇ®ÂèØËÉΩË¢´Á¶ÅÁî®/Á©∫Èó¥‰∏çË∂≥ÔºåÂøΩÁï•Âç≥ÂèØ\n      }\n    },\n    clearChat () {\n      this.messages = []\n      this.conversationId = ''\n      this.saveToStorage()\n      ElMessage.success('Â∑≤Ê∏ÖÁ©∫ÂØπËØù')\n      this.$nextTick(() => this.scrollToBottom())\n    },\n    useQuick (q) {\n      if (this.sending) return\n      this.inputText = q\n      this.$nextTick(() => this.send())\n    },\n    pushMsg (role, text) {\n      const msg = {\n        id: `${Date.now()}_${Math.random().toString(16).slice(2)}`,\n        role,\n        text: String(text ?? ''),\n        ts: Date.now()\n      }\n      this.messages.push(msg)\n      this.saveToStorage()\n      this.$nextTick(() => this.scrollToBottom())\n    },\n    formatTime (ts) {\n      try {\n        const d = new Date(ts)\n        const hh = String(d.getHours()).padStart(2, '0')\n        const mm = String(d.getMinutes()).padStart(2, '0')\n        return `${hh}:${mm}`\n      } catch (e) {\n        return ''\n      }\n    },\n    scrollToBottom () {\n      try {\n        const el = this.$el.querySelector('.ai-body .el-scrollbar__wrap')\n        if (el) el.scrollTop = el.scrollHeight\n      } catch (e) {\n        // DOM ÂÆπÂô®ÂèØËÉΩÊöÇÊú™Ê∏≤ÊüìÊàñ‰∏çÂ≠òÂú®ÔºåÂøΩÁï•Âç≥ÂèØ\n      }\n    },\n    async send () {\n      const text = this.inputText.trim()\n      if (!text || this.sending) return\n\n      if (!this.resolvedUserId) {\n        ElMessage.warning('Êú™Ëé∑ÂèñÂà∞Áî®Êà∑‰ø°ÊÅØÔºåËØ∑ÂÖàÁôªÂΩïÂêéÂÜç‰ΩøÁî® AI Âä©Êâã')\n        return\n      }\n\n      this.pushMsg('user', text)\n      this.inputText = ''\n      this.sending = true\n\n      try {\n        const payload = {\n          userId: this.resolvedUserId,\n          message: text,\n          conversationId: this.conversationId || null\n        }\n\n        // ÂÖºÂÆπÔºö‰Ω†ÁöÑ request.js ÂèØËÉΩÂ∑≤Áªè return response.data\n        const res = await this.$axios.post('/ai/chat', payload)\n        const body = (res && typeof res.code !== 'undefined')\n            ? res\n            : (res && res.data ? res.data : null)\n\n        if (!body || Number(body.code) !== 200) {\n          const msg = (body && (body.msg || body.message)) ? (body.msg || body.message) : 'AI ËØ∑Ê±ÇÂ§±Ë¥•'\n          throw new Error(msg)\n        }\n\n        const data = body.data || {}\n        if (data.conversationId) this.conversationId = data.conversationId\n        this.pushMsg('assistant', data.reply || 'ÔºàAI Êú™ËøîÂõûÂÜÖÂÆπÔºâ')\n      } catch (e) {\n        this.pushMsg('assistant', `ÔºàÂá∫Èîô‰∫ÜÔºâ${e?.message || 'AI ËØ∑Ê±ÇÂ§±Ë¥•'}`)\n      } finally {\n        this.sending = false\n        this.saveToStorage()\n        this.$nextTick(() => this.scrollToBottom())\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.ai-lite-root {}\n\n/* ===== ÊÇ¨ÊµÆÁêÉ ===== */\n.ai-float {\n  position: fixed;\n  z-index: 4000;\n  width: 56px;\n  height: 56px;\n}\n.ai-float-inner {\n  position: relative;\n  width: 56px;\n  height: 56px;\n  border-radius: 999px;\n  background: linear-gradient(180deg, rgba(64,158,255,1) 0%, rgba(64,158,255,0.86) 100%);\n  box-shadow: 0 14px 26px rgba(0,0,0,0.22);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  user-select: none;\n  cursor: pointer;\n  transition: transform 0.15s ease, box-shadow 0.15s ease;\n}\n.ai-float-inner:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 16px 30px rgba(0,0,0,0.24);\n}\n.ai-float-inner.dragging {\n  transform: scale(1.06);\n  box-shadow: 0 18px 34px rgba(0,0,0,0.28);\n  cursor: grabbing;\n}\n.ai-float-emoji {\n  font-size: 22px;\n  line-height: 1;\n}\n.ai-float-dot {\n  position: absolute;\n  right: 6px;\n  top: 6px;\n  width: 10px;\n  height: 10px;\n  border-radius: 999px;\n  background: #ff4d4f;\n  box-shadow: 0 0 0 2px rgba(255,255,255,0.9);\n}\n\n/* ===== ÊäΩÂ±âÊï¥‰Ωì ===== */\n.ai-shell {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background: #f6f7fb;\n}\n.ai-header {\n  padding: 14px 14px 12px;\n  display: flex;\n  justify-content: space-between;\n  gap: 12px;\n  background: #ffffff;\n  border-bottom: 1px solid rgba(0,0,0,0.06);\n}\n.ai-brand { display: flex; gap: 10px; align-items: center; }\n.ai-brand-icon {\n  width: 36px; height: 36px; border-radius: 12px;\n  background: rgba(64,158,255,0.12);\n  display: flex; align-items: center; justify-content: center;\n  font-size: 18px;\n}\n.ai-title { font-weight: 800; font-size: 16px; line-height: 1.1; }\n.ai-subtitle { margin-top: 4px; font-size: 12px; color: rgba(0,0,0,0.55); }\n.ai-actions { display: flex; gap: 8px; flex-shrink: 0; align-items: flex-start; }\n\n/* ===== Âø´Êç∑ÊèêÈóÆ ===== */\n.ai-quick {\n  padding: 10px 14px;\n  background: #ffffff;\n  border-bottom: 1px solid rgba(0,0,0,0.06);\n}\n.ai-quick-row { display: flex; align-items: flex-start; gap: 10px; }\n.ai-quick-label { font-size: 12px; color: rgba(0,0,0,0.55); padding-top: 3px; flex-shrink: 0; }\n.ai-quick-items { display: flex; flex-wrap: wrap; gap: 8px; }\n.ai-chip { cursor: pointer; user-select: none; border-radius: 999px; }\n\n/* ===== Ê∂àÊÅØÂå∫ ===== */\n.ai-body { flex: 1; padding: 12px 14px; }\n.ai-msgs { display: flex; flex-direction: column; gap: 12px; }\n.ai-empty {\n  padding: 14px 12px;\n  border-radius: 14px;\n  background: rgba(255,255,255,0.8);\n  border: 1px dashed rgba(0,0,0,0.12);\n}\n.ai-empty-title { font-weight: 700; font-size: 14px; color: rgba(0,0,0,0.85); }\n.ai-empty-desc { margin-top: 6px; font-size: 12px; color: rgba(0,0,0,0.55); line-height: 1.55; }\n\n.ai-msg { display: flex; gap: 10px; align-items: flex-end; }\n.ai-msg.is-user { flex-direction: row-reverse; }\n\n.ai-avatar {\n  width: 30px; height: 30px; border-radius: 10px;\n  background: rgba(0,0,0,0.06);\n  color: rgba(0,0,0,0.75);\n  display: flex; align-items: center; justify-content: center;\n  font-size: 12px; flex-shrink: 0;\n}\n.ai-msg.is-user .ai-avatar {\n  background: rgba(64,158,255,0.18);\n  color: rgba(64,158,255,1);\n}\n\n.ai-bubble {\n  max-width: 78%;\n  padding: 10px 12px;\n  border-radius: 14px;\n  box-shadow: 0 8px 20px rgba(0,0,0,0.08);\n  background: #ffffff;\n  border: 1px solid rgba(0,0,0,0.04);\n}\n.ai-msg.is-user .ai-bubble {\n  background: rgba(64,158,255,0.12);\n  border: 1px solid rgba(64,158,255,0.10);\n}\n\n.ai-text {\n  white-space: pre-wrap;\n  word-break: break-word;\n  font-size: 13px;\n  line-height: 1.6;\n  color: rgba(0,0,0,0.88);\n}\n.ai-meta {\n  margin-top: 6px;\n  font-size: 11px;\n  color: rgba(0,0,0,0.45);\n  text-align: right;\n}\n\n/* ===== ËæìÂÖ•Âå∫ ===== */\n.ai-input {\n  padding: 12px 14px 14px;\n  background: #ffffff;\n  border-top: 1px solid rgba(0,0,0,0.06);\n}\n.ai-sendbar {\n  margin-top: 10px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 10px;\n}\n.ai-hint { font-size: 12px; color: rgba(0,0,0,0.5); line-height: 1.4; }\n.ai-send-btn { min-width: 84px; border-radius: 12px; }\n\n/* Drawer body Âéª padding */\n:deep(.el-drawer__body) { padding: 0; }\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}